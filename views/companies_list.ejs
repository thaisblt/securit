<!DOCTYPE html>
<html lang="fr">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Dashboard</title>
   <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <header>
        <div class="avatar">
            <a href="/visit_list">
                <img class="img_header" src="/images/avatar.jpg" alt="Avatar Lambda">
            </a>
            <p class="info_affichee" ><%= name %></p>
        </div>
        <a href="/visit_list">
            <img class="img_logo" src="/images/securit_logo.png" alt="Logo Securit">
        </a>
        <form action="/logout" method="POST" class="logout-form">
            <button type="submit" class="button logout-button">
                Déconnexion
            </button>
        </form>

    </header><br>

    <% if (role === 'ADMIN') { %>
    <nav class="tabs">
        <a href="/visit_list"
        class="tab <%= activeTab === 'visits' ? 'active' : '' %>">
            Visites
        </a>
        <a href="/companies_list"
        class="tab <%= activeTab === 'companies' ? 'active' : '' %>">
            Entreprises
        </a>
    </nav>
    <% } %>

    <form method="POST" action="/companies_search">
        <div class="search">
            <input
                type="search"
                id="search"
                name="search"
                placeholder="Rechercher une entreprise..."
            />
        </div>
    </form>


    <main class="page-content">
        <div class="page-header">
            <h2>Entreprises</h2>
            <a href="/new_company" class="btn-add">＋ Nouvelle entreprise</a>
        </div>

        <table class="table">
            <thead>
                <tr>
                    <th>Nom</th>
                    <th>Adresse</th>
                    <th>Dernière visite</th>
                </tr>
            </thead>
            <tbody>
                <% if (companies.length === 0) { %>
                    <tr>
                        <td colspan="3" class="empty">Aucune entreprise enregistrée</td>
                    </tr>
                <% } else { %>
                    <% companies.forEach(company => { %>
                        <tr>
                            <td><%= company.name %></td>
                            <td><%= company.address %></td>
                            <td>
                                <%= company.lastVisit 
                                    ? new Date(company.lastVisit).toLocaleDateString() 
                                    : '—' %>
                            </td>
                        </tr>
                    <% }) %>
                <% } %>
            </tbody>
        </table>
    </main>

    
</body>
</html>
